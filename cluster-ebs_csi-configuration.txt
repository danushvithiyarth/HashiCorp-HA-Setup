1.Associate OIDC Provider:
Required only once per cluster, allows Kubernetes service accounts in your cluster to assume IAM roles (via OIDC).

eksctl utils associate-iam-oidc-provider --region eu-north-1 --cluster vault --approve

2.Create the IAM Service Account for the EBS CSI driver:
Allow Kubernetes to use EBS CSI driven for provisoning volumes

eksctl create iamserviceaccount \
  --region eu-north-1 \
  --name ebs-csi-controller-sa \
  --namespace kube-system \
  --cluster vault \
  --attach-policy-arn arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy \
  --override-existing-serviceaccounts \
  --approve


3. Install the EBS CSI driver:

a. AWS-managed EBS CSI Driver Add-on

eksctl create addon \
  --name aws-ebs-csi-driver \
  --cluster vault \
  --region eu-north-1 \
  --service-account-role-arn arn:aws:iam::<your-account-id>:role/eksctl-vault-addon-iamserviceaccount-kube-system-ebs-csi-controller-sa-Role \
  --force

b. Manual Open-Source Deployment (using kubectl apply -k):

kubectl apply -k "github.com/kubernetes-sigs/aws-ebs-csi-driver/deploy/kubernetes/overlays/stable/ecr/?ref=release-1.11"


